/*
 * This file was generated by the Gradle 'init' task.
 *
 * This is a general purpose Gradle build.
 * Learn how to create Gradle builds at https://guides.gradle.org/creating-new-gradle-builds/
 */
 buildscript {
  repositories {
    jcenter()
  }
}
plugins {
    id 'org.jbake.site' version '1.0.0'
    id 'org.ajoberstar.git-publish' version '0.3.2'
}

defaultTasks 'bake'

def siteDir = "output"

gitPublish {
    // where to publish to (repo must exist)
    repoUri = 'https://github.com/chunlinyao/chunlinyao.github.io.git'
    // (or 'https://github.com/ajoberstar/test-repo.git', depending on authentication)
    
    // branch will be created if it doesn't exist
    branch = 'master'

    // generally, you don't need to touch this
    repoDir = file("$siteDir") // defaults to $buildDir/gitPublish

    // what to publish, this is a standard CopySpec
    contents {
        //from 'CNAME'
        from 'README.md'
    }

    // what to keep in the existing branch (include=keep)
    /*
    preserve {
        include '1.0.0/**'
        exclude '1.0.0/temp.txt'
    }
    */

    // message used when committing changes
    commitMessage = 'Publishing a new page' // defaults to 'Generated by gradle-git-publish'

}

jbake {
    srcDirName  = "src"
    destDirName = "../$siteDir"
    clearCache = true
}
clean { doLast {
        delete fileTree(dir: "$siteDir", exclude: '.git')
    }
}

bake.dependsOn gitPublishReset
gitPublishCommit.dependsOn bake

task publish(dependsOn: gitPublishPush, group: 'render',
            description: "Publishes buildDir to Github Pages on 'gh-pages' branch")
